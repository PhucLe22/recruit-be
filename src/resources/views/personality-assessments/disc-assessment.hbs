<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i ki·ªÉm tra h√†nh vi DISC - JobLife</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .main-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            padding: 2rem;
            color: white;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar h2 {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-circle {
            width: 150px;
            height: 150px;
            margin: 2rem auto;
            position: relative;
        }

        .progress-ring {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 8;
            fill: none;
        }

        .progress-ring-fill {
            stroke: white;
            stroke-width: 8;
            fill: none;
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 0.5rem;
            margin-top: 2rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .grid-item {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
        }

        .grid-item.current {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
            transform: scale(1.1);
        }

        .grid-item.answered {
            background: rgba(40, 167, 69, 0.3);
            border-color: #28a745;
        }

        .grid-item.flagged::after {
            content: 'üö©';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .assessment-header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
            animation: slideDown 0.8s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .assessment-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .view-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .view-btn.active {
            background: white;
            color: #f093fb;
        }

        .intro-section {
            background: white;
            border-radius: 25px;
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            margin-bottom: 2rem;
            animation: fadeIn 1s ease;
            text-align: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .intro-section h2 {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        .intro-section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .disc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .disc-item {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.1));
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            border-left: 4px solid #f093fb;
            transition: transform 0.3s ease;
        }

        .disc-item:hover {
            transform: translateY(-5px);
        }

        .disc-letter {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .disc-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.3rem;
        }

        .disc-desc {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .instruction-box {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.1));
            border-left: 5px solid #f093fb;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: left;
            color: #555;
        }

        .question-container {
            display: none;
            animation: slideIn 0.5s ease;
        }

        .question-container.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .question-card {
            background: white;
            border-radius: 25px;
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            margin-bottom: 2rem;
            position: relative;
            border-left: 5px solid #f093fb;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .question-number {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .question-actions {
            display: flex;
            gap: 1rem;
        }

        .flag-btn {
            background: none;
            border: 2px solid #ffc107;
            color: #ffc107;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .flag-btn.flagged {
            background: #ffc107;
            color: white;
        }

        .question-text {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 2.5rem;
            line-height: 1.6;
            font-weight: 500;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .option {
            position: relative;
        }

        .option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .option label {
            display: flex;
            align-items: flex-start;
            padding: 1.5rem;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
        }

        .option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border-color: #f093fb;
            transform: scale(1.02);
        }

        .option label:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .option input[type="radio"]:checked + label:hover {
            background: linear-gradient(135deg, #e082ea, #e4465b);
        }

        .option-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }

        .option-text {
            font-size: 1rem;
            line-height: 1.4;
        }

        .questions-grid-container {
            display: none;
        }

        .questions-grid-container.active {
            display: block;
        }

        .questions-grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-question-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .grid-question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .grid-question-card.answered {
            border-left-color: #28a745;
        }

        .grid-question-card.flagged {
            border-left-color: #ffc107;
        }

        .grid-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .grid-question-number {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .grid-question-text {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .grid-options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .grid-option {
            position: relative;
        }

        .grid-option label {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .grid-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border-color: #f093fb;
        }

        .grid-option label:hover {
            background: #e9ecef;
        }

        .grid-option input[type="radio"]:checked + label:hover {
            background: linear-gradient(135deg, #e082ea, #e4465b);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            gap: 1rem;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #f093fb;
            border: 2px solid #f093fb;
        }

        .btn-secondary:hover {
            background: #f093fb;
            color: white;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f093fb;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 999;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .content-area {
                margin-left: 0;
                padding: 4rem 1rem 1rem;
            }

            .question-grid {
                max-height: 200px;
            }

            .options-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .assessment-header h1 {
                font-size: 2rem;
            }

            .question-card {
                padding: 2rem;
            }

            .question-text {
                font-size: 1.2rem;
            }

            .navigation {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .disc-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .grid-options-container {
                grid-template-columns: 1fr;
            }
        }

        .stats-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            color: white;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="main-container">
        <aside class="sidebar" id="sidebar">
            <h2><i class="fas fa-users"></i> DISC</h2>

            <div class="progress-circle">
                <svg class="progress-ring" viewBox="0 0 120 120">
                    <circle class="progress-ring-bg" cx="60" cy="60" r="54"></circle>
                    <circle class="progress-ring-fill" cx="60" cy="60" r="54"
                            stroke-dasharray="0 339.292" id="progressRing"></circle>
                </svg>
                <div class="progress-text">
                    <div id="progressPercent">0%</div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">Ho√†n th√†nh</div>
                </div>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="answeredCount">0</div>
                    <div class="stat-label">ƒê√£ tr·∫£ l·ªùi</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="flaggedCount">0</div>
                    <div class="stat-label">ƒê√£ ƒë√°nh d·∫•u</div>
                </div>
            </div>

            <h3 style="margin: 2rem 0 1rem; font-size: 1.1rem; opacity: 0.9;">Danh s√°ch c√¢u h·ªèi</h3>
            <div class="question-grid" id="questionGrid">
                <!-- Question items will be generated here -->
            </div>

            <div style="margin-top: 2rem;">
                <button class="btn btn-secondary" style="width: 100%; margin-bottom: 1rem;" onclick="showFlaggedQuestions()">
                    <i class="fas fa-flag"></i> Xem c√¢u ƒë√£ ƒë√°nh d·∫•u
                </button>
                <button class="btn btn-success" style="width: 100%;" onclick="submitAssessment()" id="submitBtn" disabled>
                    <i class="fas fa-check"></i> Ho√†n th√†nh b√†i ki·ªÉm tra
                </button>
            </div>
        </aside>

        <main class="content-area">
            <div class="assessment-header">
                <h1><i class="fas fa-users"></i> B√†i ki·ªÉm tra h√†nh vi DISC</h1>
                <p>Ph√¢n t√≠ch 4 ki·ªÉu h√†nh vi trong m√¥i tr∆∞·ªùng l√†m vi·ªác: Dominance, Influence, Steadiness, Conscientiousness</p>
            </div>

            <div class="view-toggle">
                <button class="view-btn active" onclick="setViewMode('single')">
                    <i class="fas fa-list"></i> T·ª´ng c√¢u
                </button>
                <button class="view-btn" onclick="setViewMode('grid')">
                    <i class="fas fa-th"></i> L∆∞·ªõi
                </button>
            </div>

            <div id="introSection" class="intro-section">
                <h2><i class="fas fa-info-circle"></i> Gi·ªõi thi·ªáu b√†i ki·ªÉm tra DISC</h2>
                <p>
                    M√¥ h√¨nh DISC l√† m·ªôt c√¥ng c·ª• ƒë√°nh gi√° h√†nh vi ph·ªï bi·∫øn trong m√¥i tr∆∞·ªùng l√†m vi·ªác, gi√∫p b·∫°n hi·ªÉu r√µ v·ªÅ phong c√°ch giao ti·∫øp, l√†m vi·ªác v√† t∆∞∆°ng t√°c c·ªßa b·∫£n th√¢n.
                    B√†i ki·ªÉm tra n√†y s·∫Ω x√°c ƒë·ªãnh ki·ªÉu h√†nh vi ch·ªß ƒë·∫°o c·ªßa b·∫°n trong c√°c t√¨nh hu·ªëng c√¥ng vi·ªác kh√°c nhau.
                </p>

                <div class="instruction-box">
                    <i class="fas fa-lightbulb"></i>
                    <strong>H∆∞·ªõng d·∫´n:</strong> V·ªõi m·ªói c√¢u h·ªèi, h√£y ch·ªçn ph∆∞∆°ng √°n m√¥ t·∫£ ch√≠nh x√°c nh·∫•t c√°ch b·∫°n th∆∞·ªùng ph·∫£n ·ª©ng ho·∫∑c h√†nh ƒë·ªông trong m√¥i tr∆∞·ªùng l√†m vi·ªác.
                </div>

                <div class="disc-grid">
                    <div class="disc-item">
                        <div class="disc-letter">D</div>
                        <div class="disc-name">Dominance</div>
                        <div class="disc-desc">Th·ªëng tr·ªã, quy·∫øt ƒëo√°n</div>
                    </div>
                    <div class="disc-item">
                        <div class="disc-letter">I</div>
                        <div class="disc-name">Influence</div>
                        <div class="disc-desc">·∫¢nh h∆∞·ªüng, giao ti·∫øp</div>
                    </div>
                    <div class="disc-item">
                        <div class="disc-letter">S</div>
                        <div class="disc-name">Steadiness</div>
                        <div class="disc-desc">Ki√™n ƒë·ªãnh, ·ªïn ƒë·ªãnh</div>
                    </div>
                    <div class="disc-item">
                        <div class="disc-letter">C</div>
                        <div class="disc-name">Conscientiousness</div>
                        <div class="disc-desc">T·∫≠n t√¢m, c·∫©n tr·ªçng</div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="startAssessment()">
                    <i class="fas fa-play"></i> B·∫Øt ƒë·∫ßu b√†i ki·ªÉm tra
                </button>
            </div>

            <div id="questionContainer" class="question-container">
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number" id="questionNumber">1</div>
                        <div class="question-actions">
                            <button class="flag-btn" id="flagBtn" onclick="toggleFlag()">
                                <i class="fas fa-flag"></i> ƒê√°nh d·∫•u
                            </button>
                        </div>
                    </div>
                    <div class="question-text" id="questionText">
                        Question text will appear here
                    </div>
                    <div class="options-container" id="optionsContainer">
                        <!-- Options will be generated here -->
                    </div>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                        <i class="fas fa-arrow-left"></i> C√¢u tr∆∞·ªõc
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">
                        C√¢u ti·∫øp theo <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div id="gridContainer" class="questions-grid-container">
                <div class="questions-grid" id="questionsGrid">
                    <!-- Grid questions will be generated here -->
                </div>
            </div>

            <div id="loadingSection" class="loading">
                <div class="spinner"></div>
                <h3>ƒêang ph√¢n t√≠ch k·∫øt qu·∫£...</h3>
                <p>H·ªá th·ªëng AI ƒëang ph√¢n t√≠ch c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n. Vui l√≤ng ch·ªù trong gi√¢y l√°t.</p>
            </div>
        </main>
    </div>

    <script>
        const questions = [
            {
                id: 1,
                text: "Trong c√°c cu·ªôc h·ªçp, t√¥i th∆∞·ªùng:",
                options: [
                    { text: "D·∫´n d·∫Øt cu·ªôc th·∫£o lu·∫≠n v√† ƒë∆∞a ra quy·∫øt ƒë·ªãnh nhanh ch√≥ng", icon: "fa-gavel", value: "D" },
                    { text: "Thuy·∫øt ph·ª•c v√† t·∫°o nƒÉng l∆∞·ª£ng cho nh√≥m", icon: "fa-comments", value: "I" },
                    { text: "L·∫Øng nghe v√† h·ªó tr·ª£ s·ª± ƒë·ªìng thu·∫≠n", icon: "fa-handshake", value: "S" },
                    { text: "Ph√¢n t√≠ch d·ªØ li·ªáu v√† ƒë·∫£m b·∫£o t√≠nh ch√≠nh x√°c", icon: "fa-chart-line", value: "C" }
                ]
            },
            {
                id: 2,
                text: "Khi ƒë·ªëi m·∫∑t v·ªõi th√°ch th·ª©c m·ªõi, t√¥i:",
                options: [
                    { text: "Ti·∫øp c·∫≠n m·ªôt c√°ch quy·∫øt ƒëo√°n v√† h√†nh ƒë·ªông ngay l·∫≠p t·ª©c", icon: "fa-rocket", value: "D" },
                    { text: "T√¨m ki·∫øm s·ª± h·ªó tr·ª£ v√† √Ω ki·∫øn t·ª´ ng∆∞·ªùi kh√°c", icon: "fa-users", value: "I" },
                    { text: "L√™n k·∫ø ho·∫°ch c·∫©n th·∫≠n t·ª´ng b∆∞·ªõc m·ªôt", icon: "fa-list-check", value: "C" },
                    { text: "Duy tr√¨ ph∆∞∆°ng ph√°p hi·ªán t·∫°i ƒë√£ ƒë∆∞·ª£c ch·ª©ng minh", icon: "fa-shield-alt", value: "S" }
                ]
            },
            {
                id: 3,
                text: "Phong c√°ch giao ti·∫øp c·ªßa t√¥i l√†:",
                options: [
                    { text: "Th·∫≥ng th·∫Øn, t·∫≠p trung v√†o k·∫øt qu·∫£", icon: "fa-bullseye", value: "D" },
                    { text: "Nhi·ªát t√¨nh, truy·ªÅn c·∫£m h·ª©ng", icon: "fa-fire", value: "I" },
                    { text: "H·ªó tr·ª£, ƒë·ªìng c·∫£m", icon: "fa-heart", value: "S" },
                    { text: "Ch√≠nh x√°c, logic", icon: "fa-brain", value: "C" }
                ]
            },
            {
                id: 4,
                text: "Khi l√†m vi·ªác nh√≥m, t√¥i th∆∞·ªùng:",
                options: [
                    { text: "ƒê·∫£m b·∫£o nh√≥m ƒëi ƒë√∫ng h∆∞·ªõng v√† ƒë·∫°t m·ª•c ti√™u", icon: "fa-compass", value: "D" },
                    { text: "Khuy·∫øn kh√≠ch s·ª± s√°ng t·∫°o v√† √Ω t∆∞·ªüng m·ªõi", icon: "fa-lightbulb", value: "I" },
                    { text: "Gi√∫p h√≤a gi·∫£i xung ƒë·ªôt v√† duy tr√¨ h√≤a kh√≠", icon: "fa-dove", value: "S" },
                    { text: "Cung c·∫•p th√¥ng tin chi ti·∫øt v√† ph√¢n t√≠ch", icon: "fa-microscope", value: "C" }
                ]
            },
            {
                id: 5,
                text: "Ph·∫£n ·ª©ng c·ªßa t√¥i v·ªõi √°p l·ª±c th·ªùi gian l√†:",
                options: [
                    { text: "L√†m vi·ªác hi·ªáu qu·∫£ h∆°n v√† ƒë∆∞a ra quy·∫øt ƒë·ªãnh nhanh", icon: "fa-tachometer-alt", value: "D" },
                    { text: "T·∫≠p trung v√†o ∆∞u ti√™n v√† giao vi·ªác cho ng∆∞·ªùi kh√°c", icon: "fa-tasks", value: "I" },
                    { text: "Duy tr√¨ b√¨nh tƒ©nh v√† l√†m vi·ªác c√≥ ph∆∞∆°ng ph√°p", icon: "fa-spa", value: "S" },
                    { text: "Ki·ªÉm tra k·ªπ l∆∞·ª°ng ƒë·ªÉ tr√°nh sai s√≥t", icon: "fa-search", value: "C" }
                ]
            },
            {
                id: 6,
                text: "Khi x·ª≠ l√Ω xung ƒë·ªôt, t√¥i:",
                options: [
                    { text: "ƒê·ªëi m·∫∑t tr·ª±c ti·∫øp v√† gi·∫£i quy·∫øt nhanh ch√≥ng", icon: "fa-fist-raised", value: "D" },
                    { text: "T√¨m ki·∫øm gi·∫£i ph√°p win-win qua ƒë√†m ph√°n", icon: "fa-balance-scale", value: "I" },
                    { text: "Tr√°nh ƒë·ªëi ƒë·∫ßu v√† t√¨m c√°ch h√≤a gi·∫£i", icon: "fa-peace", value: "S" },
                    { text: "Ph√¢n t√≠ch nguy√™n nh√¢n g·ªëc r·ªÖ", icon: "fa-search-plus", value: "C" }
                ]
            },
            {
                id: 7,
                text: "M√¥i tr∆∞·ªùng l√†m vi·ªác l√Ω t∆∞·ªüng c·ªßa t√¥i l√†:",
                options: [
                    { text: "Nhanh nh·∫°y, c·∫°nh tranh, t·∫≠p trung k·∫øt qu·∫£", icon: "fa-trophy", value: "D" },
                    { text: "S√°ng t·∫°o, h·ª£p t√°c, ƒë·∫ßy nƒÉng l∆∞·ª£ng", icon: "fa-palette", value: "I" },
                    { text: "·ªîn ƒë·ªãnh, h·ªó tr·ª£, th√¢n thi·ªán", icon: "fa-home", value: "S" },
                    { text: "C√≥ c·∫•u tr√∫c, logic, ch·∫•t l∆∞·ª£ng cao", icon: "fa-building", value: "C" }
                ]
            },
            {
                id: 8,
                text: "Khi nh·∫≠n ph·∫£n h·ªìi, t√¥i:",
                options: [
                    { text: "ƒê√°nh gi√° nhanh v√† h√†nh ƒë·ªông ngay l·∫≠p t·ª©c", icon: "fa-bolt", value: "D" },
                    { text: "L·∫Øng nghe c·ªüi m·ªü v√† th·∫£o lu·∫≠n", icon: "fa-comments", value: "I" },
                    { text: "C√¢n nh·∫Øc k·ªπ v√† ph·∫£n ·ª©ng th·∫≠n tr·ªçng", icon: "fa-scale-balanced", value: "S" },
                    { text: "Y√™u c·∫ßu th√¥ng tin chi ti·∫øt v√† c·ª• th·ªÉ", icon: "fa-clipboard-list", value: "C" }
                ]
            },
            {
                id: 9,
                text: "ƒêi·ªÉm m·∫°nh l·ªõn nh·∫•t c·ªßa t√¥i l√†:",
                options: [
                    { text: "Kh·∫£ nƒÉng l√£nh ƒë·∫°o v√† ra quy·∫øt ƒë·ªãnh", icon: "fa-crown", value: "D" },
                    { text: "K·ªπ nƒÉng giao ti·∫øp v√† truy·ªÅn c·∫£m h·ª©ng", icon: "fa-megaphone", value: "I" },
                    { text: "S·ª± ki√™n nh·∫´n v√† ƒë√°ng tin c·∫≠y", icon: "fa-user-check", value: "S" },
                    { text: "S·ª± ch√≠nh x√°c v√† ch√∫ tr·ªçng chi ti·∫øt", icon: "fa-gem", value: "C" }
                ]
            },
            {
                id: 10,
                text: "Khi b·∫Øt ƒë·∫ßu d·ª± √°n m·ªõi, t√¥i:",
                options: [
                    { text: "Thi·∫øt l·∫≠p m·ª•c ti√™u r√µ r√†ng v√† ƒë∆∞·ªùng l·ªëi", icon: "fa-flag", value: "D" },
                    { text: "X√¢y d·ª±ng enthusiasm v√† s·ª± h·ªó tr·ª£", icon: "fa-hands-helping", value: "I" },
                    { text: "Thu th·∫≠p th√¥ng tin v√† l·∫≠p k·∫ø ho·∫°ch chi ti·∫øt", icon: "fa-clipboard", value: "C" },
                    { text: "Theo quy tr√¨nh ƒë√£ ƒë∆∞·ª£c thi·∫øt l·∫≠p", icon: "fa-cogs", value: "S" }
                ]
            },
            {
                id: 11,
                text: "Phong c√°ch ra quy·∫øt ƒë·ªãnh c·ªßa t√¥i:",
                options: [
                    { text: "Nhanh ch√≥ng, quy·∫øt ƒëo√°n, ch·∫•p nh·∫≠n r·ªßi ro", icon: "fa-dice", value: "D" },
                    { text: "D·ª±a tr√™n con ng∆∞·ªùi v√† c·∫£m x√∫c", icon: "fa-smile", value: "I" },
                    { text: "Th·∫≠n tr·ªçng, t√¨m ki·∫øm s·ª± ƒë·ªìng thu·∫≠n", icon: "fa-users-cog", value: "S" },
                    { text: "Ph√¢n t√≠ch s√¢u, d·ª±a tr√™n d·ªØ li·ªáu", icon: "fa-database", value: "C" }
                ]
            },
            {
                id: 12,
                text: "Khi giao ti·∫øp v·ªõi c·∫•p tr√™n, t√¥i:",
                options: [
                    { text: "Tr·ª±c ti·∫øp, t·ª± tin, th√°ch th·ª©c khi c·∫ßn", icon: "fa-arrow-up", value: "D" },
                    { text: "Nhi·ªát t√¨nh, x√¢y d·ª±ng m·ªëi quan h·ªá t·ªët", icon: "fa-handshake-alt", value: "I" },
                    { text: "T√¥n tr·ªçng, t√¥n tr·ªçng quy·ªÅn h·∫°n", icon: "fa-user-tie", value: "S" },
                    { text: "Cung c·∫•p th√¥ng tin ch√≠nh x√°c, ƒë·∫ßy ƒë·ªß", icon: "fa-file-alt", value: "C" }
                ]
            },
            {
                id: 13,
                text: "Trong c√°c t√¨nh hu·ªëng thay ƒë·ªïi, t√¥i:",
                options: [
                    { text: "N·∫Øm b·∫Øt c∆° h·ªôi v√† d·∫´n d·∫Øt s·ª± thay ƒë·ªïi", icon: "fa-random", value: "D" },
                    { text: "Adapt nhanh v√† truy·ªÅn nƒÉng l∆∞·ª£ng t√≠ch c·ª±c", icon: "fa-sync-alt", value: "I" },
                    { text: "C·∫ßn th·ªùi gian ƒë·ªÉ th√≠ch nghi", icon: "fa-hourglass-half", value: "S" },
                    { text: "Y√™u c·∫ßu l√Ω do v√† k·∫ø ho·∫°ch chi ti·∫øt", icon: "fa-question-circle", value: "C" }
                ]
            },
            {
                id: 14,
                text: "Khi ƒë√°nh gi√° th√†nh c√¥ng, t√¥i t·∫≠p trung v√†o:",
                options: [
                    { text: "K·∫øt qu·∫£ cu·ªëi c√πng v√† s·ª± hi·ªáu qu·∫£", icon: "fa-chart-bar", value: "D" },
                    { text: "S·ª± c√¥ng nh·∫≠n v√† relationships", icon: "fa-award", value: "I" },
                    { text: "S·ª± ·ªïn ƒë·ªãnh v√† h√†i l√≤ng c·ªßa nh√≥m", icon: "fa-smile-beam", value: "S" },
                    { text: "Ch·∫•t l∆∞·ª£ng v√† s·ª± ch√≠nh x√°c", icon: "fa-medal", value: "C" }
                ]
            },
            {
                id: 15,
                text: "Phong c√°ch h·ªçc h·ªèi c·ªßa t√¥i l√†:",
                options: [
                    { text: "H·ªçc qua th·ª±c h√†nh v√† th·ª≠ nghi·ªám", icon: "fa-flask", value: "D" },
                    { text: "H·ªçc qua t∆∞∆°ng t√°c v√† th·∫£o lu·∫≠n", icon: "fa-graduation-cap", value: "I" },
                    { text: "H·ªçc qua quan s√°t v√† th·ª±c h√†nh c√≥ h∆∞·ªõng d·∫´n", icon: "fa-eye", value: "S" },
                    { text: "H·ªçc qua nghi√™n c·ª©u v√† ph√¢n t√≠ch chi ti·∫øt", icon: "fa-book", value: "C" }
                ]
            },
            {
                id: 16,
                text: "Khi ƒë·ªëi m·∫∑t v·ªõi th·∫•t b·∫°i, t√¥i:",
                options: [
                    { text: "Nhanh ch√≥ng chuy·ªÉn h∆∞·ªõng v√† t√¨m gi·∫£i ph√°p m·ªõi", icon: "fa-redo", value: "D" },
                    { text: "T√¨m ki·∫øm s·ª± h·ªó tr·ª£ v√† ƒë·ªông vi√™n", icon: "fa-hands", value: "I" },
                    { text: "Ph√¢n t√≠ch c·∫©n th·∫≠n v√† r√∫t kinh nghi·ªám", icon: "fa-microscope", value: "S" },
                    { text: "Ki·ªÉm tra l·∫°i quy tr√¨nh v√† c·∫£i thi·ªán", icon: "fa-tools", value: "C" }
                ]
            },
            {
                id: 17,
                text: "Khi qu·∫£n l√Ω th·ªùi gian, t√¥i:",
                options: [
                    { text: "∆Øu ti√™n c√°c t√°c v·ª• quan tr·ªçng nh·∫•t", icon: "fa-calendar-check", value: "D" },
                    { text: "Linh ho·∫°t v√† th√≠ch ·ª©ng v·ªõi thay ƒë·ªïi", icon: "fa-clock", value: "I" },
                    { text: "L√†m theo l·ªãch tr√¨nh c·ªë ƒë·ªãnh", icon: "fa-calendar-alt", value: "S" },
                    { text: "L√™n k·∫ø ho·∫°ch chi ti·∫øt v√† tu√¢n th·ªß nghi√™m ng·∫∑t", icon: "fa-list-ol", value: "C" }
                ]
            },
            {
                id: 18,
                text: "Khi giao vi·ªác cho ng∆∞·ªùi kh√°c, t√¥i:",
                options: [
                    { text: "Giao k·∫øt qu·∫£ mong mu·ªën v√† t·ª± do th·ª±c hi·ªán", icon: "fa-paper-plane", value: "D" },
                    { text: "Gi·∫£i th√≠ch t·∫ßm quan tr·ªçng v√† truy·ªÅn c·∫£m h·ª©ng", icon: "fa-microphone", value: "I" },
                    { text: "H∆∞·ªõng d·∫´n chi ti·∫øt v√† h·ªó tr·ª£ li√™n t·ª•c", icon: "fa-chalkboard-teacher", value: "S" },
                    { text: "Cung c·∫•p quy tr√¨nh r√µ r√†ng v√† ti√™u chu·∫©n", icon: "fa-clipboard-check", value: "C" }
                ]
            },
            {
                id: 19,
                text: "Ph·∫£n ·ª©ng c·ªßa t√¥i v·ªõi s·ª± kh√¥ng ch·∫Øc ch·∫Øn l√†:",
                options: [
                    { text: "H√†nh ƒë·ªông quy·∫øt ƒëo√°n ƒë·ªÉ gi·∫£m thi·ªÉu r·ªßi ro", icon: "fa-shield-virus", value: "D" },
                    { text: "T√¨m ki·∫øm th√¥ng tin v√† √Ω ki·∫øn ƒëa d·∫°ng", icon: "fa-globe", value: "I" },
                    { text: "Duy tr√¨ s·ª± b√¨nh tƒ©nh v√† ki√™n nh·∫´n", icon: "fa-om", value: "S" },
                    { text: "Nghi√™n c·ª©u k·ªπ l∆∞·ª°ng tr∆∞·ªõc khi h√†nh ƒë·ªông", icon: "fa-search-dollar", value: "C" }
                ]
            },
            {
                id: 20,
                text: "Khi gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ, t√¥i:",
                options: [
                    { text: "T·∫≠p trung v√†o gi·∫£i ph√°p nhanh v√† hi·ªáu qu·∫£", icon: "fa-puzzle-piece", value: "D" },
                    { text: "Brainstorm √Ω t∆∞·ªüng s√°ng t·∫°o", icon: "fa-lightbulb", value: "I" },
                    { text: "C√¢n nh·∫Øc t√°c ƒë·ªông ƒë·∫øn m·ªçi ng∆∞·ªùi", icon: "fa-user-friends", value: "S" },
                    { text: "Ph√¢n t√≠ch nguy√™n nh√¢n v√† y·∫øu t·ªë li√™n quan", icon: "fa-project-diagram", value: "C" }
                ]
            },
            {
                id: 21,
                text: "Khi thuy·∫øt tr√¨nh, t√¥i:",
                options: [
                    { text: "ƒêi th·∫≥ng v√†o v·∫•n ƒë·ªÅ v√† t·∫≠p trung k·∫øt qu·∫£", icon: "fa-bullhorn", value: "D" },
                    { text: "S·ª≠ d·ª•ng storytelling v√† t∆∞∆°ng t√°c", icon: "fa-theater-masks", value: "I" },
                    { text: "Chu·∫©n b·ªã k·ªπ l∆∞·ª°ng v√† tr√¨nh b√†y c√≥ c·∫•u tr√∫c", icon: "fa-desktop", value: "S" },
                    { text: "Cung c·∫•p d·ªØ li·ªáu chi ti·∫øt v√† ch√≠nh x√°c", icon: "fa-chart-pie", value: "C" }
                ]
            },
            {
                id: 22,
                text: "Khi l√†m vi·ªác ƒë·ªôc l·∫≠p, t√¥i:",
                options: [
                    { text: "Thrive v·ªõi t·ª± do v√† tr√°ch nhi·ªám", icon: "fa-fighter-jet", value: "D" },
                    { text: "Th∆∞·ªùng t√¨m ki·∫øm t∆∞∆°ng t√°c v√† ph·∫£n h·ªìi", icon: "fa-comments", value: "I" },
                    { text: "Th√≠ch c√≥ h∆∞·ªõng d·∫´n r√µ r√†ng", icon: "fa-map-signs", value: "S" },
                    { text: "Ph√¢n t√≠ch v√† l·∫≠p k·∫ø ho·∫°ch chi ti·∫øt", icon: "fa-sitemap", value: "C" }
                ]
            },
            {
                id: 23,
                text: "Khi ƒë·ªëi m·∫∑t v·ªõi √Ω ki·∫øn tr√°i chi·ªÅu, t√¥i:",
                options: [
                    { text: "Th·∫£o lu·∫≠n logic v√† b·∫£o v·ªá quan ƒëi·ªÉm", icon: "fa-comments-alt", value: "D" },
                    { text: "L·∫Øng nghe v√† t√¨m ki·∫øm s·ª± th·∫•u hi·ªÉu", icon: "fa-ear", value: "I" },
                    { text: "Tr√°nh ƒë·ªëi ƒë·∫ßu v√† t√¨m gi·∫£i ph√°p h√≤a b√¨nh", icon: "fa-dove", value: "S" },
                    { text: "Y√™u c·∫ßu b·∫±ng ch·ª©ng v√† ph√¢n t√≠ch", icon: "fa-balance-scale-right", value: "C" }
                ]
            },
            {
                id: 24,
                text: "M·ª•c ti√™u l√¢u d√†i c·ªßa t√¥i l√†:",
                options: [
                    { text: "ƒê·∫°t ƒë∆∞·ª£c v·ªã tr√≠ l√£nh ƒë·∫°o v√† ·∫£nh h∆∞·ªüng", icon: "fa-mountain", value: "D" },
                    { text: "X√¢y d·ª±ng m·∫°ng l∆∞·ªõi quan h·ªá r·ªông l·ªõn", icon: "fa-network-wired", value: "I" },
                    { text: "T·∫°o s·ª± ·ªïn ƒë·ªãnh v√† h√†i l√≤ng", icon: "fa-anchor", value: "S" },
                    { text: "Tr·ªü th√†nh chuy√™n gia trong lƒ©nh v·ª±c", icon: "fa-user-graduate", value: "C" }
                ]
            }
        ];

        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let flaggedQuestions = new Set();
        let viewMode = 'single';
        let assessmentStarted = false;

        function startAssessment() {
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('questionContainer').classList.add('active');
            assessmentStarted = true;
            currentQuestion = 0;
            initializeGrid();
            updateGrid();
            showQuestion(0);
            updateProgress();
        }

        function setViewMode(mode) {
            viewMode = mode;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.view-btn').classList.add('active');

            if (mode === 'single') {
                document.getElementById('questionContainer').classList.add('active');
                document.getElementById('gridContainer').classList.remove('active');
            } else {
                document.getElementById('questionContainer').classList.remove('active');
                document.getElementById('gridContainer').classList.add('active');
            }
        }

        function initializeGrid() {
            const gridContainer = document.getElementById('questionsGrid');
            gridContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const gridItem = document.createElement('div');
                gridItem.className = 'grid-question-card';
                gridItem.id = `grid_question_${index}`;

                gridItem.innerHTML = `
                    <div class="grid-question-header">
                        <div class="grid-question-number">${index + 1}</div>
                        <button class="flag-btn ${flaggedQuestions.has(index) ? 'flagged' : ''}"
                                onclick="toggleGridFlag(${index})" id="grid_flag_${index}">
                            <i class="fas fa-flag"></i>
                        </button>
                    </div>
                    <div class="grid-question-text">${question.text}</div>
                    <div class="grid-options-container">
                        ${question.options.map((option, optionIndex) => `
                            <div class="grid-option">
                                <input type="radio" id="grid_option_${index}_${optionIndex}"
                                       name="grid_option_${index}" value="${optionIndex}"
                                       ${answers[index] === optionIndex ? 'checked' : ''}>
                                <label for="grid_option_${index}_${optionIndex}">
                                    <i class="fas ${option.icon}" style="margin-right: 0.5rem;"></i>
                                    <span>${option.text}</span>
                                </label>
                            </div>
                        `).join('')}
                    </div>
                `;

                gridContainer.appendChild(gridItem);

                // Add event listeners for grid options
                gridItem.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        updateAnswer(index, parseInt(this.value));
                        updateGridItemStatus(index);
                    });
                });

                updateGridItemStatus(index);
            });
        }

        function updateGridItemStatus(index) {
            const gridItem = document.getElementById(`grid_question_${index}`);
            if (answers[index] !== null) {
                gridItem.classList.add('answered');
            } else {
                gridItem.classList.remove('answered');
            }

            if (flaggedQuestions.has(index)) {
                gridItem.classList.add('flagged');
            } else {
                gridItem.classList.remove('flagged');
            }
        }

        function showQuestion(index) {
            const question = questions[index];
            document.getElementById('questionNumber').textContent = index + 1;
            document.getElementById('questionText').textContent = question.text;

            // Generate options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, optionIndex) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';

                optionDiv.innerHTML = `
                    <input type="radio" id="option_${optionIndex}" name="disc_option" value="${optionIndex}">
                    <label for="option_${optionIndex}">
                        <i class="fas ${option.icon} option-icon"></i>
                        <span class="option-text">${option.text}</span>
                    </label>
                `;

                optionsContainer.appendChild(optionDiv);
            });

            // Add event listeners
            optionsContainer.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updateAnswer(currentQuestion, parseInt(this.value));
                });
            });

            // Set previous answer if exists
            if (answers[index] !== null) {
                const radio = document.querySelector(`input[name="disc_option"][value="${answers[index]}"]`);
                if (radio) radio.checked = true;
            }

            // Update flag button
            const flagBtn = document.getElementById('flagBtn');
            if (flaggedQuestions.has(index)) {
                flagBtn.classList.add('flagged');
                flagBtn.innerHTML = '<i class="fas fa-flag"></i> B·ªè ƒë√°nh d·∫•u';
            } else {
                flagBtn.classList.remove('flagged');
                flagBtn.innerHTML = '<i class="fas fa-flag"></i> ƒê√°nh d·∫•u';
            }

            updateGrid();
            updateNavigationButtons();
        }

        function updateGrid() {
            const gridContainer = document.getElementById('questionGrid');
            if (!gridContainer) return;

            gridContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const gridItem = document.createElement('div');
                gridItem.className = 'grid-item';
                if (index === currentQuestion) gridItem.classList.add('current');
                if (answers[index] !== null) gridItem.classList.add('answered');
                if (flaggedQuestions.has(index)) gridItem.classList.add('flagged');

                gridItem.textContent = index + 1;
                gridItem.onclick = () => {
                    currentQuestion = index;
                    showQuestion(index);
                    setViewMode('single');
                };

                gridContainer.appendChild(gridItem);
            });
        }

        function updateAnswer(questionIndex, value) {
            // If value is an index, convert to DISC value
            if (typeof value === 'number') {
                const option = questions[questionIndex].options[value];
                answers[questionIndex] = option.value || 'C'; // Default to C
            } else {
                answers[questionIndex] = value;
            }
            updateProgress();
            updateSubmitButton();
        }

        function calculateDISCType() {
            const scores = { D: 0, I: 0, S: 0, C: 0 };
            answers.forEach(answer => {
                if (answer && scores.hasOwnProperty(answer)) {
                    scores[answer]++;
                }
            });

            // Find primary trait
            let primaryTrait = 'C';
            let maxScore = 0;
            for (const [key, value] of Object.entries(scores)) {
                if (value > maxScore) {
                    maxScore = value;
                    primaryTrait = key;
                }
            }

            // Calculate total valid answers
            const totalValidAnswers = Object.values(scores).reduce((sum, score) => sum + score, 0);
            
            // Calculate percentages with proper rounding to ensure total = 100
            const percentages = {};
            let remainingPercentage = 100;
            const traits = ['D', 'I', 'S', 'C'];
            
            traits.forEach((trait, index) => {
                if (index === traits.length - 1) {
                    // Last trait gets remaining percentage
                    percentages[trait] = remainingPercentage;
                } else {
                    percentages[trait] = Math.round((scores[trait] / totalValidAnswers) * 100);
                    remainingPercentage -= percentages[trait];
                }
            });

            return {
                type: primaryTrait,
                scores: scores,
                percentages: percentages
            };
        }

        function toggleFlag() {
            const index = currentQuestion;
            if (flaggedQuestions.has(index)) {
                flaggedQuestions.delete(index);
            } else {
                flaggedQuestions.add(index);
            }
            showQuestion(index);
        }

        function toggleGridFlag(index) {
            if (flaggedQuestions.has(index)) {
                flaggedQuestions.delete(index);
            } else {
                flaggedQuestions.add(index);
            }
            updateGridItemStatus(index);
            updateGrid();
            updateProgress();
        }

        function updateProgress() {
            const answered = answers.filter(answer => answer !== null).length;
            const progress = Math.round((answered / questions.length) * 100);

            const circumference = 2 * Math.PI * 54;
            const offset = circumference - (progress / 100) * circumference;

            const progressRing = document.getElementById('progressRing');
            if (progressRing) {
                progressRing.style.strokeDasharray = `${circumference - offset} ${circumference}`;
            }

            const progressPercent = document.getElementById('progressPercent');
            if (progressPercent) {
                progressPercent.textContent = `${progress}%`;
            }

            const answeredCount = document.getElementById('answeredCount');
            if (answeredCount) {
                answeredCount.textContent = answered;
            }

            const flaggedCount = document.getElementById('flaggedCount');
            if (flaggedCount) {
                flaggedCount.textContent = flaggedQuestions.size;
            }
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            const allAnswered = answers.every(answer => answer !== null);
            submitBtn.disabled = !allAnswered || !assessmentStarted;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = currentQuestion === 0;

            if (currentQuestion === questions.length - 1) {
                nextBtn.innerHTML = 'Ho√†n th√†nh <i class="fas fa-check"></i>';
                nextBtn.onclick = submitAssessment;
            } else {
                nextBtn.innerHTML = 'C√¢u ti·∫øp theo <i class="fas fa-arrow-right"></i>';
                nextBtn.onclick = nextQuestion;
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        }

        function showFlaggedQuestions() {
            if (flaggedQuestions.size === 0) {
                alert('B·∫°n ch∆∞a ƒë√°nh d·∫•u c√¢u h·ªèi n√†o.');
                return;
            }

            let flaggedMessage = 'C√°c c√¢u h·ªèi ƒë√£ ƒë√°nh d·∫•u:\n\n';
            flaggedQuestions.forEach(index => {
                flaggedMessage += `C√¢u ${index + 1}: ${questions[index].text}\n`;
            });

            alert(flaggedMessage);
        }

        function submitAssessment() {
            const allAnswered = answers.every(answer => answer !== null);

            if (!allAnswered) {
                const unanswered = answers.map((answer, index) => answer === null ? index + 1 : null)
                                          .filter(index => index !== null);
                alert(`Vui l√≤ng tr·∫£ l·ªùi t·∫•t c·∫£ c√°c c√¢u h·ªèi. C√≤n ${unanswered.length} c√¢u ch∆∞a tr·∫£ l·ªùi: ${unanswered.join(', ')}`);
                return;
            }

            if (flaggedQuestions.size > 0) {
                const confirmSubmit = confirm(`B·∫°n c√≥ ${flaggedQuestions.size} c√¢u h·ªèi ƒë√£ ƒë√°nh d·∫•u. B·∫°n c√≥ ch·∫Øc mu·ªën ho√†n th√†nh b√†i ki·ªÉm tra kh√¥ng?`);
                if (!confirmSubmit) return;
            }

            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('gridContainer').classList.remove('active');
            document.getElementById('loadingSection').classList.add('active');

            // Calculate DISC type
            const discResult = calculateDISCType();

            fetch('/personality-assessments/disc/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    answers: answers,
                    discType: discResult.type,
                    scores: discResult.scores,
                    percentages: discResult.percentages
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = data.redirectTo;
                } else {
                    alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');
                    document.getElementById('loadingSection').classList.remove('active');
                    document.getElementById('questionContainer').style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');
                document.getElementById('loadingSection').classList.remove('active');
                document.getElementById('questionContainer').style.display = 'block';
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (!assessmentStarted || document.getElementById('questionContainer').style.display === 'none') return;

            if (e.key >= '1' && e.key <= '4') {
                const radio = document.querySelector(`input[name="disc_option"][value="${parseInt(e.key) - 1}"]`);
                if (radio) {
                    radio.checked = true;
                    updateAnswer(currentQuestion, parseInt(e.key) - 1);
                }
            } else if (e.key === 'ArrowRight' && currentQuestion < questions.length - 1) {
                nextQuestion();
            } else if (e.key === 'ArrowLeft' && currentQuestion > 0) {
                previousQuestion();
            } else if (e.key === 'Enter' && answers.every(answer => answer !== null)) {
                submitAssessment();
            } else if (e.key === 'f' || e.key === 'F') {
                toggleFlag();
            }
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const menuBtn = document.querySelector('.mobile-menu-btn');

            if (window.innerWidth <= 1024 &&
                !sidebar.contains(e.target) &&
                !menuBtn.contains(e.target) &&
                sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        });
    </script>
</body>
</html>