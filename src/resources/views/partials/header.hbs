<!-- Header CSS -->
<link href="/css/header.css" rel="stylesheet">

<!-- Debug info - remove in production -->
{{!-- <div style="display: block; background: yellow; padding: 10px; margin: 10px; border: 1px solid red;">
  <h3>DEBUG INFO</h3>
  <strong>isLogin:</strong> {{isLogin}}<br>
  <strong>user:</strong> {{#if user}}{{user.name}} ({{user.email}}){{else}}No user{{/if}}<br>
  <strong>userType:</strong> {{userType}}<br>
  <strong>headerData.isAuthenticated:</strong> {{headerData.isAuthenticated}}<br>
  <strong>session user:</strong> {{#if req.session.user}}Exists{{else}}None{{/if}}<br>
  <strong>session business:</strong> {{#if req.session.business}}Exists{{else}}None{{/if}}<br>
  <strong>cookies:</strong> {{#if req.cookies.accessToken}}Token exists{{else}}No token{{/if}}<br>
  <strong>isLogin:</strong> {{isLogin}}<br> 
</div> --}}

<!-- Your existing header content -->
<header class="header">
  <div class="header-container">
    <a href="/" class="logo">
      <div class="logo-icon">
        <i class="fas fa-rocket"></i>
      </div>
      <div class="logo-text">
        <span class="logo-main">JobLife</span>
        <span class="logo-tagline">Viá»‡c lÃ m cho má»i ngÆ°á»i</span>
      </div>
    </a>
    <nav class="main-nav">
      <ul class="nav-menu">
        <!-- Jobs Mega Dropdown -->
        <li class="nav-item mega-dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-briefcase"></i>
            <span>Viá»‡c LÃ m</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="mega-menu">
            <div class="mega-menu-content">
              <div class="mega-menu-section">
                <h4 class="mega-menu-title">
                  <i class="fas fa-search"></i>
                  TÃ¬m kiáº¿m viá»‡c lÃ m
                </h4>
                <div class="mega-menu-links">
                  <a href="/jobs/search-results" class="mega-menu-link">
                    <span class="link-icon">ğŸ”</span>
                    <div class="link-content">
                      <span class="link-title">TÃ¬m kiáº¿m viá»‡c lÃ m</span>
                      <span class="link-desc">KhÃ¡m phÃ¡ hÃ ng ngÃ n cÆ¡ há»™i</span>
                    </div>
                  </a>
                  <a href="/jobs/search-results?sortBy=date&sortOrder=desc" class="mega-menu-link">
                    <span class="link-icon">ğŸ†•</span>
                    <div class="link-content">
                      <span class="link-title">Viá»‡c lÃ m má»›i nháº¥t</span>
                      <span class="link-desc">Cáº­p nháº­t trong 24h</span>
                    </div>
                  </a>
                  <a href="/jobs/search-results?featured=true" class="mega-menu-link featured">
                    <span class="link-icon">ğŸ”¥</span>
                    <div class="link-content">
                      <span class="link-title">Viá»‡c lÃ m ná»•i báº­t</span>
                      <span class="link-desc">Top cÃ´ng viá»‡c hot nháº¥t</span>
                    </div>
                    <span class="link-badge">Hot</span>
                  </a>
                  <a href="/jobs/search-results?types=remote" class="mega-menu-link">
                    <span class="link-icon">ğŸ </span>
                    <div class="link-content">
                      <span class="link-title">LÃ m viá»‡c tá»« xa</span>
                      <span class="link-desc">Remote & Hybrid</span>
                    </div>
                  </a>
                </div>
              </div>

              <div class="mega-menu-section">
                <h4 class="mega-menu-title">
                  <i class="fas fa-filter"></i>
                  Theo ngÃ nh nghá»
                </h4>
                <div class="category-grid">
                  <a href="/jobs/it" class="category-item">
                    <span class="category-icon">ğŸ’»</span>
                    <span class="category-name">IT & Software</span>
                  </a>
                  <a href="/jobs/marketing" class="category-item">
                    <span class="category-icon">ğŸ“±</span>
                    <span class="category-name">Marketing</span>
                  </a>
                  <a href="/jobs/design" class="category-item">
                    <span class="category-icon">ğŸ¨</span>
                    <span class="category-name">Design</span>
                  </a>
                  <a href="/jobs/sales" class="category-item">
                    <span class="category-icon">ğŸ’¼</span>
                    <span class="category-name">Sales</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </li>

        <!-- Companies Dropdown -->
        <li class="nav-item dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-building"></i>
            <span>CÃ´ng Ty</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="dropdown-menu">
            <a href="/business/list" class="dropdown-item">
              <span class="item-icon">ğŸ“‹</span>
              <span class="item-title">Danh sÃ¡ch cÃ´ng ty</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/business/register" class="dropdown-item featured">
              <span class="item-icon">â­</span>
              <span class="item-title">ÄÄƒng kÃ½ nhÃ  tuyá»ƒn dá»¥ng</span>
              <span class="item-badge">For Business</span>
            </a>
            <a href="/business/login" class="dropdown-item">
              <span class="item-icon">ğŸš€</span>
              <span class="item-title">ÄÄƒng nháº­p tuyá»ƒn dá»¥ng</span>
              <span class="item-arrow">â†’</span>
            </a>
          </div>
        </li>

        <!-- Career Tools Dropdown -->
        <li class="nav-item dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-tools"></i>
            <span>CÃ´ng cá»¥ nghá» nghiá»‡p</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="dropdown-menu">
            <a href="/cv/uploadCV" class="dropdown-item">
              <span class="item-icon">ğŸ“„</span>
              <span class="item-title">Táº£i CV & Gá»£i Ã½ viá»‡c lÃ m</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/users/profile" class="dropdown-item">
              <span class="item-icon">ğŸ¨</span>
              <span class="item-title">Quáº£n lÃ½ há»“ sÆ¡ cÃ¡ nhÃ¢n</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/users/upload-avatar" class="dropdown-item featured">
              <span class="item-icon">ğŸ“¸</span>
              <span class="item-title">Cáº­p nháº­t áº£nh Ä‘áº¡i diá»‡n</span>
              <span class="item-badge">Profile</span>
            </a>
            <a href="/personality-assessments" class="dropdown-item featured">
              <span class="item-icon">ğŸ§ </span>
              <span class="item-title">BÃ i kiá»ƒm tra tÃ­nh cÃ¡ch</span>
              <span class="item-badge">MBTI, Big Five, DISC</span>
            </a>
            <a href="/jobs/search-results" class="dropdown-item">
              <span class="item-icon">ğŸ’°</span>
              <span class="item-title">TÃ¬m viá»‡c lÆ°Æ¡ng cao</span>
              <span class="item-arrow">â†’</span>
            </a>
          </div>
        </li>

        <!-- Resources Dropdown -->
        <li class="nav-item dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-graduation-cap"></i>
            <span>TÃ i nguyÃªn</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="dropdown-menu">
            <a href="/" class="dropdown-item">
              <span class="item-icon">ğŸ“–</span>
              <span class="item-title">Trang chá»§ & Blog</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/auth/register" class="dropdown-item">
              <span class="item-icon">ğŸ’¡</span>
              <span class="item-title">HÆ°á»›ng dáº«n Ä‘Äƒng kÃ½</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/cv-assistant" class="dropdown-item">
              <span class="item-icon">ğŸ¤–</span>
              <span class="item-title">CV AI Assistant</span>
              <span class="item-arrow">â†’</span>
            </a>
          </div>
        </li>
      </ul>
    </nav>

    <!-- Auth Actions -->
    <div class="auth-actions">
      {{#if isLogin}}
        {{#if (eq userType 'user')}}
          <!-- User dropdown -->
          <div class="user-dropdown">
            <button class="user-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="User menu">
              <div class="avatar-container">
                {{#if user.avatar}}
                  <img src="{{user.avatar}}" alt="{{user.name}}" class="user-avatar" onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\'avatar-placeholder\' style=\'background-color: {{randomColor user._id}}\'><i class=\'fas fa-user\'></i></div>'">
                {{else}}
                  <div class="avatar-placeholder" style="background-color: {{randomColor user._id}};">
                    {{#if user.name}}
                      {{substring (uppercase user.name) 0 1}}
                    {{else}}
                      <i class="fas fa-user"></i>
                    {{/if}}
                  </div>
                {{/if}}
                {{#if user.isOnline}}
                  <span class="online-status" title="Online"></span>
                {{/if}}
              </div>
              <span class="user-name">{{user.name}}</span>
              <i class="fas fa-chevron-down dropdown-arrow"></i>
            </button>
          <div class="dropdown-menu user-menu" aria-label="User menu">
            <div class="user-menu-header">
              {{#if user.avatar}}
                <img src="{{user.avatar}}" alt="" class="user-menu-avatar" onerror="console.error('Error loading avatar in menu:', this.src); this.onerror=null; this.src='/images/default-avatar.png';">
              {{else}}
                <div class="avatar-placeholder user-menu-avatar" style="background-color: {{randomColor user._id}};">
                  {{#if user.name}}
                    {{substring (uppercase user.name) 0 1}}
                  {{else}}
                    <i class="fas fa-user"></i>
                  {{/if}}
                </div>
              {{/if}}
              <div class="user-menu-info">
                <h4 class="truncate">{{user.name}}</h4>
                <p class="truncate">{{user.email}}</p>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="/users/profile" class="dropdown-item">
              <span class="item-icon">ğŸ‘¤</span>
              <span class="item-title">Há»“ sÆ¡ cÃ¡ nhÃ¢n</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/users/applied-jobs" class="dropdown-item">
              <span class="item-icon">ğŸ“‹</span>
              <span class="item-title">Viá»‡c lÃ m Ä‘Ã£ á»©ng tuyá»ƒn</span>
              <span class="item-count">{{user.applicationsCount}}</span>
            </a>
            <a href="/users/saved-jobs" class="dropdown-item">
              <span class="item-icon">â¤ï¸</span>
              <span class="item-title">Viá»‡c lÃ m Ä‘Ã£ lÆ°u</span>
              <span class="item-count">{{user.savedJobsCount}}</span>
            </a>
            <a href="/users/recommendations" class="dropdown-item featured">
              <span class="item-icon">ğŸ¯</span>
              <span class="item-title">Gá»£i Ã½ cho báº¡n</span>
              <span class="item-badge">AI</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="/users/settings" class="dropdown-item">
              <span class="item-icon">âš™ï¸</span>
              <span class="item-title">CÃ i Ä‘áº·t</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/auth/logout" class="dropdown-item logout">
              <span class="item-icon">ğŸšª</span>
              <span class="item-title">ÄÄƒng xuáº¥t</span>
              <span class="item-arrow">â†’</span>
            </a>
      </div>
    </div>
  {{else if (eq userType 'business')}}
          <!-- Business dropdown -->
          <div class="user-dropdown">
          <button class="user-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Business menu">
            <div class="avatar-container">
              {{#if business.logoPath}}
                <img src="{{business.logoPath}}" alt="{{business.companyName}}" class="user-avatar" onerror="this.onerror=null; this.src='/images/default-company.png';">
              {{else}}
                <div class="avatar-placeholder" style="background-color: {{randomColor business._id}};">
                  {{#if business.companyName}}
                    {{substring (uppercase business.companyName) 0 1}}
                  {{else}}
                    <i class="fas fa-building"></i>
                  {{/if}}
                </div>
              {{/if}}
            </div>
            <span class="user-name">{{business.companyName}}</span>
            <i class="fas fa-chevron-down dropdown-arrow"></i>
          </button>
          <div class="dropdown-menu user-menu" aria-label="Business menu">
            <div class="user-menu-header">
              {{#if business.logoPath}}
                <img src="{{business.logoPath}}" alt="" class="user-menu-avatar">
              {{else}}
                <div class="avatar-placeholder user-menu-avatar" style="background-color: {{randomColor business._id}};">
                  {{#if business.companyName}}
                    {{substring (uppercase business.companyName) 0 1}}
                  {{else}}
                    <i class="fas fa-building"></i>
                  {{/if}}
                </div>
              {{/if}}
              <div class="user-menu-info">
                <h4 class="truncate">{{business.companyName}}</h4>
                <p class="truncate">{{business.email}}</p>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="/business/dashboard" class="dropdown-item">
              <span class="item-icon">ğŸ“Š</span>
              <span class="item-title">Báº£ng Ä‘iá»u khiá»ƒn</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/business/jobs" class="dropdown-item">
              <span class="item-icon">ğŸ’¼</span>
              <span class="item-title">Quáº£n lÃ½ tin tuyá»ƒn dá»¥ng</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/business/applications" class="dropdown-item">
              <span class="item-icon">ğŸ“„</span>
              <span class="item-title">Há»“ sÆ¡ á»©ng tuyá»ƒn</span>
              <span class="item-arrow">â†’</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="/business/settings" class="dropdown-item">
              <span class="item-icon">âš™ï¸</span>
              <span class="item-title">CÃ i Ä‘áº·t</span>
              <span class="item-arrow">â†’</span>
            </a>
            <a href="/auth/logout" class="dropdown-item logout">
              <span class="item-icon">ğŸšª</span>
              <span class="item-title">ÄÄƒng xuáº¥t</span>
              <span class="item-arrow">â†’</span>
            </a>
          </div>
        </div>
      {{/if}}
    {{else}}
          <!-- Login/Register buttons -->
          <div class="auth-buttons">
          <a href="/auth/login" class="btn btn-login">
            <i class="fas fa-sign-in-alt"></i>
            ÄÄƒng nháº­p
          </a>
          <a href="/auth/register" class="btn btn-signup">
            <i class="fas fa-user-plus"></i>
            ÄÄƒng kÃ½
          </a>
        </div>
      {{/if}}
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle">
      <div class="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
  </div>
</header>

<!-- Header Spacer -->
<div class="header-spacer"></div> 